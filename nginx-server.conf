# Unified Nginx Configuration for Mavryk Projects (Certbot-friendly)
# Copy this to /etc/nginx/sites-available/mavryk-unified.conf

# UPSTREAMS
upstream website_web {
    server localhost:4001;
    keepalive 32;
}
upstream website_api {
    server localhost:4000;
    keepalive 32;
}
upstream orderlist_frontend {
    server localhost:8081;
    keepalive 32;
}
upstream orderlist_backend_api {
    server localhost:3001;
    keepalive 32;
}
upstream orderlist_backend_extra {
    server localhost:5000;
    keepalive 32;
}

# ---------------------------------------------------------
# TEMPORARY PORT 80 CONFIG (For Certbot to issue SSL)
# ---------------------------------------------------------

# New Project (Website/Admin Store)
server {
    listen 80;
    server_name mavrykpremium.store api.mavrykpremium.store;

    location / {
        proxy_pass http://website_web;
        include /etc/nginx/proxy_params;
    }
}

# Old Project (Admin Orderlist)
server {
    listen 80;
    server_name admin.mavrykpremium.store;

    location / {
        proxy_pass http://orderlist_frontend;
        include /etc/nginx/proxy_params;
    }

    location /api/ {
        proxy_pass http://orderlist_backend_api;
        include /etc/nginx/proxy_params;
    }
}
